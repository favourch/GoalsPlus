<% provide(:title, 'Matches') %>

<h3>Listing matches</h3>


<%= will_paginate @matches, outer_window: 0, class: 'shortPagination pagination', page_links: false %>
<%= will_paginate @matches, class: 'pagination longPagination' %>


<% @matches.each do |match| %>


    <%
       matchTime = Time.current - match.date

       if match.date > Time.current
         local_time = distance_of_time_in_words(Time.current, match.date) + ' left'
       elsif matchTime > 0 and matchTime < 7200
         local_time = 'Match is in progress'
       else
         local_time = 'Match is over'
       end

       my_guess = Guess.where(match_id: match.id, user_id: current_user.id).limit(1).count != 0
    %>


    <div class="match" data-match="<%= match.id %>">
      <div class="match_tab">
        <div class="match_num">Match #<%= match.id %>.</div>
        <div class="match_date"><%= local_time %></div>
      </div>
      <div class="match_body">

        <% if matchTime > -86400 and matchTime < 0 and !my_guess %>
            <div class="alert-danger">There are <%= local_time %> before the kick-off. Please submit your scores soon.
            </div>
        <% end %>

        <div class="team_a">
          <div class="team_name long"><%= match.team_a.name %></div>
          <div class="team_name short"><%= match.team_a.short %></div>
          <div class="team_score"><%= match.goals_a ? match.goals_a : ''
          %><%= '('+match.pens_a.to_s+')' if match.pens_a %></div>
        </div>
        <div class="vs">vs.</div>
        <div class="team_b">
          <div class="team_name long"><%= match.team_b.name %></div>
          <div class="team_name short"><%= match.team_b.short %></div>
          <div class="team_score"><%= match.goals_b ? match.goals_b : ''
          %><%= '('+match.pens_b.to_s+')' if match.pens_b %></div>
        </div>


        <div class="match_stats">
          <div class="match_info">
            <div class="row">
              <div> <%= match.tournament.short %>, <%= match.stage.name %>  </div>
            </div>

            <div class="row">
              <div><%= match[:date].to_s(:game) %> <span class="mobile">(<%= match[:date].strftime("%Z") %> time)</span>
              </div>
            </div>

            <div class="row">
              <div><%= match.stadium.name %>
                <span class="mobile">(<%= match.stadium.city.name %>, <%= match.stadium.city.country.code %>)</span>
              </div>
            </div>
          </div>

          <% if can? :read, match %>
              <div class="match_link">
                <%= link_to 'Show', match, class: 'btn btn-primary btn-large' %>
              </div>
          <% end %>

        </div>

      </div>
    </div>
<% end %>

<%= will_paginate @matches, outer_window: 0, class: 'shortPagination pagination', page_links: false %>
<%= will_paginate @matches, class: 'pagination longPagination' %>


<br/>

<%= link_to 'New Match', new_match_path %>
